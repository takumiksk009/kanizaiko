<!DOCTYPE html>

<html lang="ja">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta charset="utf-8"/>
<title>在庫一覧</title>
<style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 20px; color: #2c3e50; margin-top: 60px; }
    h1, h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 30px; table-layout: fixed; }
    th, td { padding: 12px; border: 1px solid #ccc; text-align: center; vertical-align: middle; font-size: 16px; word-wrap: break-word; }
    th { background-color: #3498db; color: white; }
    button { padding: 10px 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
    .unused { background-color: #e67e22; color: white; }
    .delete { background-color: #c0392b; color: white; }
    .select-group { display: flex; gap: 6px; justify-content: center; align-items: center; flex-wrap: wrap; }
    .input-group {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 6px;
      width: 100%;
    }
    .input-group select,
    .input-group input {
      width: 100%;
      box-sizing: border-box;
    }
    .nav {
      position: fixed; top: 0; left: 0; right: 0; background: #34495e; padding: 10px; text-align: center;
    }
    .nav a {
      margin: 0 10px; color: white; text-decoration: none; font-weight: bold;
    }
    #editModeButton {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #2c3e50;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      z-index: 1001;
    }
    #deleteSelectedBtn {
      display: none;
      position: fixed;
      top: 60px;
      right: 10px;
      background: #c0392b;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      z-index: 1001;
    }
    input::placeholder { color: #aaa; font-style: italic; }
    select, input[type="text"] {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    .manage-label {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .manage-label span {
      font-weight: bold;
    }
    .manage-label input {
      width: 60px;
      text-align: center;
    }
    @media (max-width: 600px) {
      th, td { font-size: 14px; padding: 8px; }
      button { font-size: 13px; padding: 8px 12px; }
    }
  </style>
<!-- Firebase SDK -->



</head>
<body>
<div class="nav">
<a href="zaiko-toroku.html">📥 在庫登録</a>
<a href="inventory-list.html">📋 未使用一覧</a>
<a href="inventory-used.html">✔ 使用済み一覧</a>
<a href="report.html">📜 使用履歴</a>
</div>
<button id="editModeButton" onclick="toggleEditMode()">🛠 編集モード</button>
<button id="deleteSelectedBtn" onclick="deleteSelectedItems()">🗑 選択削除</button>
<h1>📦 未使用 在庫一覧</h1>
<div id="inventoryContainer"></div>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const inventoryContainer = document.getElementById("inventoryContainer");
  const usedReports = JSON.parse(localStorage.getItem("usedReports") || "[]");

  function renderInventory(inventory) {
    const grouped = {};
    inventory.forEach(item => {
      const usedRecord = usedReports.find(r => r === item.id || r.itemId === item.id);
      const used = usedRecord ? 1 : 0;
      const remaining = (parseInt(item.qty) || 0) - used;
      if (remaining <= 0) return;
      if (!grouped[item.category]) grouped[item.category] = [];
      grouped[item.category].push({ ...item, remaining });
    });

    inventoryContainer.innerHTML = "";
    for (const [category, items] of Object.entries(grouped)) {
      const table = document.createElement("table");
      table.innerHTML = `
        <thead>
          <tr><th colspan="6">${category}</th></tr>
          <tr>
            <th>登録者</th><th>メーカー</th><th>型式</th><th>個数</th><th>現場名</th><th>注文日</th>
          </tr>
        </thead>
        <tbody>
          ${items.map(item => `
            <tr>
              <td>${item.user}</td><td>${item.maker}</td><td>${item.model}</td>
              <td>${item.remaining}</td><td>${item.site}</td><td>${item.date}</td>
            </tr>`).join("")}
        </tbody>`;
      inventoryContainer.appendChild(table);
    }
  }

  firebase.database().ref("inventory").once("value").then(snapshot => {
    const data = snapshot.val() || {};
    const inventory = Object.entries(data).map(([id, item]) => ({ ...item, id }));
    renderInventory(inventory);
  });
});
</script>
</body>
</html>